---

import { getAllCities } from '../data/cities';

const visitedCities = getAllCities();
---

<div class="world-map-container">
  <svg 
    viewBox="0 0 2752.77 1537.63" 
    class="world-map-svg"
    xmlns="http://www.w3.org/2000/svg"
  >
    <image 
      href="/world-eckert-iv.svg" 
      width="2752.77" 
      height="1537.63"
      class="base-map"
    />
    
    <g class="city-markers">
      {visitedCities.map(city => (
        <g class="city-marker" data-city={city.name} data-country={city.country}>
          <circle 
            cx={city.x} 
            cy={city.y} 
            r="8" 
            class="city-glow"
          />
          <circle 
            cx={city.x} 
            cy={city.y} 
            r="8" 
            class="city-dot"
          />
        </g>
      ))}
    </g>
  </svg>
  
  <div class="tooltips-container">
    {visitedCities.map(city => (
      <div 
        class="city-tooltip" 
        data-city={city.name}
        style={`left: ${(city.x / 2752.77) * 100}%; top: ${(city.y / 1537.63) * 100}%;`}
      >
        {city.name}
      </div>
    ))}
  </div>
</div>

<style>
  .world-map-container {
    width: 100%;
    height: auto;
    position: relative;
  }

  .world-map-svg {
    width: 100%;
    height: auto;
    display: block;
  }

  .base-map {
    width: 100%;
    height: 100%;
  }

  .city-markers {
    pointer-events: all;
  }

  .city-marker {
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .city-glow {
    fill: rgba(59, 130, 246, 0.3);
    stroke: none;
    opacity: 0.6;
    transition: all 0.3s ease;
    pointer-events: none;
  }

  .city-dot {
    fill: #3b82f6;
    stroke: #ffffff;
    stroke-width: 1.5;
    transition: all 0.3s ease;
    pointer-events: all;
  }

  .city-marker:hover .city-glow {
    r: 12;
    opacity: 0.8;
    fill: rgba(59, 130, 246, 0.5);
  }

  .city-marker:hover .city-dot {
    r: 6;
    fill: #60a5fa;
  }

  .tooltips-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .city-tooltip {
    position: absolute;
    transform: translate(-50%, calc(-100% - 20px));
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    background: rgba(0, 0, 0, 0.85);
    color: #ffffff;
    padding: 4px 10px;
    border-radius: 4px;
    border: 1.5px solid rgba(59, 130, 246, 0.8);
    font-size: 20px;
    font-weight: 500;
    white-space: nowrap;
    z-index: 100;
  }

  @media (max-width: 768px) {
    .city-glow {
      r: 6;
    }
    
    .city-dot {
      r: 3;
    }
    
    .city-tooltip {
      font-size: 12px;
      padding: 4px 10px;
    }
    
    .city-marker:hover .city-glow {
      r: 9;
    }
    
    .city-marker:hover .city-dot {
      r: 4.5;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const cityMarkers = document.querySelectorAll('.city-marker');
    const tooltips = document.querySelectorAll('.city-tooltip');
    
    const tooltipMap = new Map<string, Element>();
    tooltips.forEach(tooltip => {
      const cityName = tooltip.getAttribute('data-city');
      if (cityName) {
        tooltipMap.set(cityName, tooltip);
      }
    });
    
    cityMarkers.forEach(marker => {
      const cityName = marker.getAttribute('data-city');
      const tooltip = cityName ? tooltipMap.get(cityName) : null;
      
      if (tooltip) {
        marker.addEventListener('mouseenter', () => {
          (tooltip as HTMLElement).style.opacity = '1';
        });
        
        marker.addEventListener('mouseleave', () => {
          (tooltip as HTMLElement).style.opacity = '0';
        });
      }
      
      marker.addEventListener('click', () => {
        const countryName = marker.getAttribute('data-country');
        console.log(`Clicked on ${cityName}, ${countryName}`);
      });
    });
  });
</script>
