---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BlogPostCard from '../components/BlogPostCard.astro';

// Fetch all posts from all three collections
const booksEntries = await getCollection('books');
const projectsEntries = await getCollection('projects');
const travelEntries = await getCollection('travel');

// Combine all posts
const allPosts = [...booksEntries, ...projectsEntries, ...travelEntries];

// Filter out draft posts and sort by pubDate in reverse chronological order
const publishedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

// Display 5 most recent posts
const recentPosts = publishedPosts.slice(0, 5);
---

<BaseLayout 
  title="Harsh Jaluka - Home" 
  description="Welcome to my personal website where I share books, projects, and travel experiences."
>
  <Header slot="header" />
  
  <div class="home-container">
    <section class="intro-section">
      <p class="intro-paragraph">
        Hi, I'm Harsh. This is my corner of the internet where I share thoughts on books I'm reading, 
        projects I'm building, places I've traveled and questions I like thinking about. 
      </p>
      
      <p class="intro-paragraph">
        Whether you're here for technical insights, book recommendations, or travel stories, I hope 
        you find something that resonates. This site is a living collection of experiences and ideas 
        that continue to shape how I see the world.
      </p>
      
      <p class="intro-paragraph">
        Feel free to explore the different sections and reach out if something sparks a conversation. 
        I'm always interested in connecting with people who share similar curiosities! The best way to find me is through email. 
      </p>
    </section>

    <section class="recent-updates-section">
      <h2 class="section-title">Recent Updates</h2>

      {recentPosts.length > 0 ? (
        <div class="posts-list">
          {recentPosts.map(post => {
            // Determine collection from the post
            const collection = post.collection;
            return (
              <BlogPostCard
                title={post.data.title}
                pubDate={post.data.pubDate}
                slug={post.slug}
                tags={post.data.tags}
                collection={collection}
              />
            );
          })}
        </div>
      ) : (
        <div class="empty-state">
          <p class="empty-message">No posts yet. Check back soon!</p>
        </div>
      )}
    </section>
  </div>

  <Footer slot="footer" />
</BaseLayout>

<style>
  /* Modern Tech Theme - Home Page Styling */
  
  .home-container {
    max-width: 800px;
    margin: 0 auto;
  }

  .intro-section {
    margin-top: var(--spacing-12);
    margin-bottom: var(--spacing-24);
  }

  .intro-paragraph {
    color: var(--color-text-on-dark);
    font-size: var(--font-size-lg);
    line-height: var(--line-height-relaxed);
    margin-bottom: var(--spacing-6);
  }

  .intro-paragraph:last-child {
    margin-bottom: 0;
  }

  .recent-updates-section {
    margin-top: var(--spacing-20);
  }

  .section-title {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-on-dark);
    margin-bottom: var(--spacing-8);
  }

  .posts-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
  }

  .empty-state {
    text-align: center;
    padding: var(--spacing-12) 0;
    background-color: var(--color-bg-content);
    border-radius: var(--radius-lg);
  }

  .empty-message {
    color: var(--color-text-on-light);
    font-size: var(--font-size-lg);
  }
</style>
